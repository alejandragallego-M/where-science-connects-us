<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Where Science Connects Us</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background-color: #f5f6f7;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    .container {
      margin: 3rem auto;
      max-width: 1000px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 2rem;
    }

    h1 {
      color: #1a1a1a;
      margin-bottom: 0.5rem;
    }

    p {
      color: #6b7280;
      margin-bottom: 2rem;
    }

    svg {
      width: 100%;
      height: 550px;
      border-radius: 10px;
    }

    .legend {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1rem;
      font-size: 0.9rem;
      color: #6b7280;
    }

    .tooltip {
      position: absolute;
      background: white;
      padding: 0.6rem 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      pointer-events: none;
      font-size: 0.9rem;
      color: #1f2937;
      border: 1px solid #e5e7eb;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .country {
      fill: #d1d5db;
      stroke: white;
      stroke-width: 0.5;
      cursor: pointer;
      transition: fill 0.2s ease;
    }

    .country.has-alumni {
      fill: #93c5fd; /* Azul suave */
    }

    .country.has-alumni:hover {
      fill: #2563eb; /* Azul brillante al pasar */
    }

    .name {
      color: #2563eb;
    }

    /* ====== Sección de estudiantes ====== */
    .students-section {
      margin: 3rem auto;
      max-width: 1000px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 2rem;
      text-align: left;
    }

    .students-section h2 {
      color: #1e3a8a;
      margin-bottom: 1rem;
      font-size: 1.3rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    thead {
      color: #1e3a8a;
      font-weight: 600;
      font-size: 1rem;
    }

    th, td {
      padding: 10px 8px;
      text-align: left;
    }

    tbody tr:hover {
      background-color: #f9fafb;
    }

  </style>
</head>

<body>
  <div class="container">
    <h1>Where Science Connects Us</h1>
    <p>Hover countries to see former members from each place. Example data is fictitious.</p>
    <svg id="worldMap"></svg>
    <div class="legend">
      <div><span style="display:inline-block;width:12px;height:12px;background:#d1d5db;margin-right:5px;border-radius:2px;"></span>Country (no alumni)</div>
      <div><span style="display:inline-block;width:12px;height:12px;background:#93c5fd;margin-right:5px;border-radius:2px;"></span>Country with alumni</div>
      <div><span style="display:inline-block;width:12px;height:12px;background:#2563eb;margin-right:5px;border-radius:2px;"></span>Hover effect</div>
    </div>
  </div>

  <div class="tooltip" id="tooltip"></div>

  <!-- Sección de estudiantes -->
  <div class="students-section">
    <h2>Former Students</h2>
    <table id="studentsTable">
      <thead>
        <tr>
          <th>Name</th>
          <th>Time at UofA</th>
          <th>Role</th>
          <th>Current Position</th>
          <th>Country</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- D3.js y TopoJSON -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://unpkg.com/topojson@3"></script>

  <script>
    const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSXbU9byb6zxmE4TCbF3eOeBQZS09EMCTLOjBdxcO87ZUka_OaqiyN9idgZ6FrwBgEe-x3Kcor4-G1W/pub?gid=0&single=true&output=csv";

    const width = 960, height = 500;
    const svg = d3.select("#worldMap").attr("viewBox", [0, 0, width, height]);
    const projection = d3.geoNaturalEarth1();
    const path = d3.geoPath(projection);
    const tooltip = d3.select("#tooltip");

    async function loadData() {
      const res = await fetch(sheetURL);
      const text = await res.text();
      const rows = text.trim().split("\n").map(r => r.split(","));
      const headers = rows.shift();
      const data = rows.map(r => Object.fromEntries(r.map((v, i) => [headers[i].trim(), v.trim()])));

      // ==== Crear diccionario país → nombres ====
      const alumniByCountry = {};
      data.forEach(d => {
        const country = d["Country"];
        if (country) {
          if (!alumniByCountry[country]) alumniByCountry[country] = [];
          alumniByCountry[country].push(d["Name"]);
        }
      });

      // ==== Mapa ====
      d3.json("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json").then(worldData => {
        const countries = topojson.feature(worldData, worldData.objects.countries).features;

        svg.selectAll("path")
          .data(countries)
          .join("path")
          .attr("class", d => alumniByCountry[d.properties.name] ? "country has-alumni" : "country")
          .attr("d", path)
          .on("mouseover", (event, d) => {
            const names = alumniByCountry[d.properties.name];
            if (names) {
              tooltip
                .style("opacity", 1)
                .html(`<strong>${d.properties.name}</strong><br><span class="name">${names.join("<br>")}</span>`)
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 30) + "px");
            }
          })
          .on("mousemove", (event) => {
            tooltip.style("left", (event.pageX + 10) + "px")
                   .style("top", (event.pageY - 30) + "px");
          })
          .on("mouseout", () => tooltip.style("opacity", 0));
      });

      // ==== Tabla ====
      const tbody = document.querySelector("#studentsTable tbody");
      tbody.innerHTML = "";
      data.forEach(d => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${d["Name"]}</td>
          <td>${d["Time at UofA"]}</td>
          <td>${d["Role"]}</td>
          <td>${d["Current Position"]}</td>
          <td>${d["Country"]}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    loadData();
  </script>
</body>
</html>
